# データ連携ギャップと調整方針

| ギャップ内容 | 影響範囲 | 調整方針 |
| --- | --- | --- |
| Sunflower POS には税額の明細が存在せず、税抜金額算出が困難 | 会計分析・税申告レポート | Maple POS の税額ロジックを流用し、税率テーブルを適用して計算列 `calculated_tax_amount` をETLで生成する。|
| Maple POS の数量は小数対応、Sunflower POS は整数のみで計量商品が正しくマッピングされない | 商品分析・在庫管理 | 商品マスタに計量フラグを追加し、Sunflower側は重量単位を別テーブルから取得して数量換算する補正処理を追加。 |
| Aurora Reservation はキャンセル理由が自由記述、Ocean Booking はノーショー判定をフラグ提供のため整合しない | 予約キャンセル分析 | Auroraの自由記述をキーワード分類し、Oceanの `no_show_flag` と合わせて標準化カテゴリを導入。 |
| Ocean Booking はUTCタイムスタンプを使用し、他システムと日付がずれる | 日次集計・店舗別比較 | 取込時にJSTへ変換し、`service_date_local` を計算して日次粒度を統一。 |
| POS側にテーブル別利用状況（席情報）が存在せず、予約席割り当てと紐づかない | 接客分析・席稼働率 | 予約システムの席エリア情報を基準としてPOSにテーブルマスタを拡張し、注文入力時に席エリアを必須入力とする運用変更を検討。 |
| 顧客識別子がシステムごとに異なるためCRM連携が困難 | マーケティング分析・LTV算出 | 電話番号・メールアドレスを正規化し、ハッシュキー `customer_unified_key` を生成。トークンや会員IDはCRM側で紐付けを実施。 |
